dist: xenial
sudo: false
cache: pip
language: python
python:
  - 2.7
  - 3.4
  - 3.5
  - 3.6
  - 3.7
matrix:
  include:
    - os: osx
      language: sh
      python: 3.7
      before_install:
        - brew update
        - brew upgrade python
        - python3 -m venv venv
        - source venv/bin/activate
    - os: windows
      language: sh
      python: 3.7
      before_install:
        - choco install python3
        - export PATH="/c/Python37:/c/Python37/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
    - os: windows
      language: sh
      python: 2.7
      before_install:
        - choco install python2
        - export PATH="/c/Python27:/c/Python27/Scripts:$PATH"
        - python -m pip install --upgrade pip wheel
before_install:
  - pip install --upgrade setuptools pip
install:
  - git --version
  - python -m pip install -e .
before_script:
  - pip install --upgrade "flake8==3.6.0" "codecov==2.0.15" "pytest==4.1.0"
  - pip install --upgrade "pytest-flake8==1.0.2" "pytest-pylint==0.13.0" "pytest-cov==2.6.1" requests-mock
script:
  - python -m pytest
after_success:
  - codecov
deploy:
  provider: pypi
  distributions: sdist bdist_wheel
  user: mozillasecurity
  password:
    secure: e4jThEPpTNuMemAn6idcqRcNjRn6sh+4j4U4YHk1/W2GE5VDN3gROCGGMprKqG4g4O4T8HAwj+qlUQ/8aAN4DLNFMhh2xfwspz9k/Gcq4zmg4Et/1fSfQBez5O7b8SYYDxd/Lb5ImygVgNil96UsH8qjQEE54qo8Sy7YpPhsmEl/sFFS0DbByUCn6YPTS3VJaJhRZj66R/xHQF5JHHUcQO3V01jjDNFmRsW0XfZicMgouVTXTTHt65IGcip6cBnurGGmehQhDcZwGxj9M/yL5O3Q31Ufy0cVchXXSxman8zbsZjyDnZVyU1B38yciPgxt1qa3HbFjxv0LrPoTjjlRpL8jqXgDzxgSDHRp/uii8vq2jBQFci2EzQSMcmId67plMHJTarqqjNTKhLosHELIcZyoy6LzK9CFJXPA73AtSiwZ+9B7/VAUDQNECsu6iXwxCULz7VbUnExANgZ6ALfdKkzwpZUyXP77dA2tvpNC6M1+tTq8tDBRVRsZr7Uw0JyPZFVE91RRfpdoCLDpbydXeYC27j3nLHPYBRrrNgvpDIegTGIjamN0AdGnbGqHwCi+l+UVYUjCwIW7cMcAbmjYVfAuY5Rxo8DUSlsaUCzOyaZ5VUQGv/cuTGesTjfGNm9daL7lHRry8vNyfkPKBFtUwjPKnxWQCZ0fAC9Qds/wgY=
  on:
    tags: true
    os: linux
    python: 2.7
